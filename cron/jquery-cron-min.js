(function(e){var t={initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:true},periods:["minute","hour","day","week","month","year"],url_set:undefined,customValues:undefined,onChange:undefined,useGentleSelect:false};var n="";for(var r=0;r<60;r++){var a=r<10?"0":"";n+="<option value='"+r+"'>"+a+r+"</option>\n"}var i="";for(var r=0;r<24;r++){var a=r<10?"0":"";i+="<option value='"+r+"'>"+a+r+"</option>\n"}var s="";for(var r=1;r<32;r++){if(r==1||r==21||r==31){var l="st"}else if(r==2||r==22){var l="nd"}else if(r==3||r==23){var l="rd"}else{var l="th"}s+="<option value='"+r+"'>"+r+l+"</option>\n"}var d="";var c=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var r=0;r<c.length;r++){d+="<option value='"+(r+1)+"'>"+c[r]+"</option>\n"}var u="";var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(var r=0;r<m.length;r++){u+="<option value='"+r+"'>"+m[r]+"</option>\n"}var f={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};var h={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};function p(e){if(typeof e=="undefined"){return false}else{return true}}function v(e){return!p(e)||typeof e=="object"}function y(t,n){if(p(n.customValues)){for(key in n.customValues){if(t==n.customValues[key]){return key}}}var r=/^((\d{1,2}|\*)\s){4}(\d{1,2}|\*)$/;if(typeof t!="string"||!r.test(t)){e.error("cron: invalid initial value");return undefined}var a=t.split(" ");var i=[0,0,1,1,0];var s=[59,23,31,12,6];for(var l=0;l<a.length;l++){if(a[l]=="*")continue;var d=parseInt(a[l]);if(p(d)&&d<=s[l]&&d>=i[l])continue;e.error("cron: invalid value found (col "+(l+1)+") in "+o.initial);return undefined}for(var c in h){if(h[c].test(t)){return c}}e.error("cron: valid but unsupported cron format. sorry.");return undefined}function g(t,n){if(!p(y(n.initial,n))){return true}if(!v(n.customValues)){return true}if(p(n.customValues)){for(key in n.customValues){if(h.hasOwnProperty(key)){e.error("cron: reserved keyword '"+key+"' should not be used as customValues key.");return true}}}return false}function b(e){var t=e.data("block");var n=hour=day=month=dow="*";var o=t["period"].find("select").val();switch(o){case"minute":break;case"hour":n=t["mins"].find("select").val();break;case"day":n=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();break;case"week":n=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();dow=t["dow"].find("select").val();break;case"month":n=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();day=t["dom"].find("select").val();break;case"year":n=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();day=t["dom"].find("select").val();month=t["month"].find("select").val();break;default:return o}return[n,hour,day,month,dow].join(" ")}var O={init:function(o){var r=o?o:{};var a=e.extend([],t,r);var l=e.extend({},t.effectOpts,r.effectOpts);e.extend(a,{minuteOpts:e.extend({},t.minuteOpts,l,r.minuteOpts),domOpts:e.extend({},t.domOpts,l,r.domOpts),monthOpts:e.extend({},t.monthOpts,l,r.monthOpts),dowOpts:e.extend({},t.dowOpts,l,r.dowOpts),timeHourOpts:e.extend({},t.timeHourOpts,l,r.timeHourOpts),timeMinuteOpts:e.extend({},t.timeMinuteOpts,l,r.timeMinuteOpts)});if(g(this,a)){return this}var c="";for(var m=0;m<a.periods.length;m++){c+="<option value='"+a.periods[m]+"'>"+a.periods[m]+"</option>\n"}var f=[],h="",v=a.customValues;if(p(v)){for(var y in v){h+="<option value='"+v[y]+"'>"+y+"</option>\n"}}f["period"]=e("<span class='cron-period'>"+"Every <select name='cron-period'>"+h+c+"</select> </span>").appendTo(this).data("root",this);var b=f["period"].find("select");b.bind("change.cron",k.periodChanged).data("root",this);if(a.useGentleSelect)b.gentleSelect(l);f["dom"]=e("<span class='cron-block cron-block-dom'>"+" on the <select name='cron-dom'>"+s+"</select> </span>").appendTo(this).data("root",this);b=f["dom"].find("select").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.domOpts);f["month"]=e("<span class='cron-block cron-block-month'>"+" of <select name='cron-month'>"+d+"</select> </span>").appendTo(this).data("root",this);b=f["month"].find("select").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.monthOpts);f["mins"]=e("<span class='cron-block cron-block-mins'>"+" at <select name='cron-mins'>"+n+"</select> minutes past the hour </span>").appendTo(this).data("root",this);b=f["mins"].find("select").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.minuteOpts);f["dow"]=e("<span class='cron-block cron-block-dow'>"+" on <select name='cron-dow'>"+u+"</select> </span>").appendTo(this).data("root",this);b=f["dow"].find("select").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.dowOpts);f["time"]=e("<span class='cron-block cron-block-time'>"+" at <select name='cron-time-hour' class='cron-time-hour'>"+i+"</select>:<select name='cron-time-min' class='cron-time-min'>"+n+" </span>").appendTo(this).data("root",this);b=f["time"].find("select.cron-time-hour").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.timeHourOpts);b=f["time"].find("select.cron-time-min").data("root",this);if(a.useGentleSelect)b.gentleSelect(a.timeMinuteOpts);f["controls"]=e("<span class='cron-controls'>&laquo; save "+"<span class='cron-button cron-button-save'></span>"+" </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",k.saveClicked).data("root",this).end();this.find("select").bind("change.cron-callback",k.somethingChanged);this.data("options",a).data("block",f);this.data("current_value",a.initial);return O["value"].call(this,a.initial)},value:function(e){if(!e){return b(this)}var t=this.data("options");var n=this.data("block");var o=t.useGentleSelect;var r=y(e,t);if(!p(r)){return false}if(p(t.customValues)&&t.customValues.hasOwnProperty(r)){r=t.customValues[r]}else{var a=e.split(" ");var i={mins:a[0],hour:a[1],dom:a[2],month:a[3],dow:a[4]};var s=f[r];for(var l=0;l<s.length;l++){var d=s[l];if(d=="time"){var c=n[d].find("select.cron-time-hour").val(i["hour"]);if(o)c.gentleSelect("update");c=n[d].find("select.cron-time-min").val(i["mins"]);if(o)c.gentleSelect("update")}else{var c=n[d].find("select").val(i[d]);if(o)c.gentleSelect("update")}}}var u=n["period"].find("select").val(r);if(o)u.gentleSelect("update");u.trigger("change");return this}};var k={periodChanged:function(){var t=e(this).data("root");var n=t.data("block"),o=t.data("options");var r=e(this).val();t.find("span.cron-block").hide();if(f.hasOwnProperty(r)){var a=f[e(this).val()];for(var i=0;i<a.length;i++){n[a[i]].show()}}},somethingChanged:function(){root=e(this).data("root");if(p(root.data("options").url_set)){if(O.value.call(root)!=root.data("current_value")){root.addClass("cron-changed");root.data("block")["controls"].fadeIn()}else{root.removeClass("cron-changed");root.data("block")["controls"].fadeOut()}}else{root.data("block")["controls"].hide()}var t=root.data("options").onChange;if(p(t)&&e.isFunction(t)){t.call(root)}},saveClicked:function(){var t=e(this);var n=t.data("root");var o=O.value.call(n);if(t.hasClass("cron-loading")){return}t.addClass("cron-loading");e.ajax({type:"POST",url:n.data("options").url_set,data:{cron:o},success:function(){n.data("current_value",o);t.removeClass("cron-loading");if(o==O.value.call(n)){n.removeClass("cron-changed");n.data("block").controls.fadeOut()}},error:function(){alert("An error occured when submitting your request. Try again?");t.removeClass("cron-loading")}})}};e.fn.cron=function(t){if(O[t]){return O[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return O.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.cron")}}})(jQuery);