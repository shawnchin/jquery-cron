(function(e){function y(e){if(typeof e=="undefined"){return false}else{return true}}function b(e){return!y(e)||typeof e=="object"}function w(t,n){var r=n?/^((\d{1,2}|\*)\s){3}((\d{1,2}|\*|\?)\s)((\d{1,2}|\*)\s)((\d{1,2}|\*|\?))$/:/^((\d{1,2}|\*)\s){2}((\d{1,2}|\*|\?)\s)((\d{1,2}|\*)\s)((\d{1,2}|\*|\?))$/;if(typeof t!="string"||!r.test(t)){e.error("cron: invalid initial value");return undefined}var i=t.split(" ");var s=n?[0,0,0,1,1,0]:[0,0,1,1,0];var u=n?[59,59,23,31,12,6]:[59,23,31,12,6];for(var a=0;a<i.length;a++){if(i[a]=="*"||i[a]=="?")continue;var f=parseInt(i[a]);if(y(f)&&f<=u[a]&&f>=s[a])continue;e.error("cron: invalid value found (col "+(a+1)+") in "+o.initial);return undefined}var l=n?g:m;for(var c in l){if(l[c].test(t)){return c}}e.error("cron: valid but unsupported cron format. sorry.");return undefined}function E(e,t){if(!y(w(t.initial,t.enableSeconds))){return true}if(!b(t.customValues)){return true}return false}function S(e){var t=e.data("block");var n=min=hour=day=month=dow="*";var r=t["period"].find("select").val();switch(r){case"minute":dow="?";break;case"hour":n=0;min=t["mins"].find("select").val();dow="?";break;case"day":n=0;min=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();dow="?";break;case"week":n=0;min=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();dow=t["dow"].find("select").val();day="?";break;case"month":n=0;min=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();day=t["dom"].find("select").val();dow="?";break;case"year":n=0;min=t["time"].find("select.cron-time-min").val();hour=t["time"].find("select.cron-time-hour").val();day=t["dom"].find("select").val();month=t["month"].find("select").val();dow="?";break;default:return r}if(e.data("options").enableSeconds)return[n,min,hour,day,month,dow].join(" ");return[min,hour,day,month,dow].join(" ")}var t={enableSeconds:false,initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:true},url_set:undefined,customValues:undefined,onChange:undefined};var n="";for(var r=0;r<60;r++){var i=r<10?"0":"";n+="<option value='"+r+"'>"+i+r+"</option>\n"}var s="";for(var r=0;r<24;r++){var i=r<10?"0":"";s+="<option value='"+r+"'>"+i+r+"</option>\n"}var u="";for(var r=1;r<32;r++){if(r==1||r==21){var a="st"}else if(r==2||r==22){var a="nd"}else if(r==3||r==23){var a="rd"}else{var a="th"}u+="<option value='"+r+"'>"+r+a+"</option>\n"}var f="";var l=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var r=0;r<l.length;r++){f+="<option value='"+(r+1)+"'>"+l[r]+"</option>\n"}var c="";var h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(var r=0;r<h.length;r++){c+="<option value='"+r+"'>"+h[r]+"</option>\n"}var p="";var d=["minute","hour","day","week","month","year"];for(var r=0;r<d.length;r++){p+="<option value='"+d[r]+"'>"+d[r]+"</option>\n"}var v={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};var m={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}(\*|\?)$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};var g={second:/^(\*\s){5}\*$/,minute:/^\d{1,2}\s(\*\s){4}\*$/,hour:/^(\d{1,2}\s){2}(\*\s){3}\*$/,day:/^(\d{1,2}\s){3}(\*\s){2}(\*|\?)$/,week:/^(\d{1,2}\s){3}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){4}\*\s\*$/,year:/^(\d{1,2}\s){5}\*$/};var x={init:function(r){var i=r?r:{};var o=e.extend([],t,i);var a=e.extend({},t.effectOpts,i.effectOpts);e.extend(o,{minuteOpts:e.extend({},t.minuteOpts,a,i.minuteOpts),domOpts:e.extend({},t.domOpts,a,i.domOpts),monthOpts:e.extend({},t.monthOpts,a,i.monthOpts),dowOpts:e.extend({},t.dowOpts,a,i.dowOpts),timeHourOpts:e.extend({},t.timeHourOpts,a,i.timeHourOpts),timeMinuteOpts:e.extend({},t.timeMinuteOpts,a,i.timeMinuteOpts)});if(E(this,o)){return this}var l=[],h="",d=o.customValues;if(y(d)){for(var v in d){h+="<option value='"+d[v]+"'>"+v+"</option>\n"}}l["period"]=e("<span class='cron-period'>"+"Every <select name='cron-period'>"+h+p+"</select> </span>").appendTo(this).find("select").bind("change.cron",T.periodChanged).data("root",this).gentleSelect(a).end();l["dom"]=e("<span class='cron-block cron-block-dom'>"+" on the <select name='cron-dom'>"+u+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(o.domOpts).data("root",this).end();l["month"]=e("<span class='cron-block cron-block-month'>"+" of <select name='cron-month'>"+f+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(o.monthOpts).data("root",this).end();l["mins"]=e("<span class='cron-block cron-block-mins'>"+" at <select name='cron-mins'>"+n+"</select> minutes past the hour </span>").appendTo(this).data("root",this).find("select").gentleSelect(o.minuteOpts).data("root",this).end();l["dow"]=e("<span class='cron-block cron-block-dow'>"+" on <select name='cron-dow'>"+c+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(o.dowOpts).data("root",this).end();l["time"]=e("<span class='cron-block cron-block-time'>"+" at <select name='cron-time-hour' class='cron-time-hour'>"+s+"</select>:<select name='cron-time-min' class='cron-time-min'>"+n+" </span>").appendTo(this).data("root",this).find("select.cron-time-hour").gentleSelect(o.timeHourOpts).data("root",this).end().find("select.cron-time-min").gentleSelect(o.timeMinuteOpts).data("root",this).end();l["controls"]=e("<span class='cron-controls'>Â« save "+"<span class='cron-button cron-button-save'></span>"+" </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",T.saveClicked).data("root",this).end();this.find("select").bind("change.cron-callback",T.somethingChanged);this.data("options",o).data("block",l);this.data("current_value",o.initial);return x["value"].call(this,o.initial)},value:function(e){if(!e){return S(this)}var t=this.data("options");var n=w(e,t.enableSeconds);if(!y(n)){return false}var r=this.data("block");var i=e.split(" ");var s={};if(t.enableSeconds)s={secs:i[0],mins:i[1],hour:i[2],dom:i[3],month:i[4],dow:i[5]};else s={mins:i[0],hour:i[1],dom:i[2],month:i[3],dow:i[4]};var o=v[n];for(var u=0;u<o.length;u++){var a=o[u];if(a=="time"){r[a].find("select.cron-time-hour").val(s["hour"]).gentleSelect("update").end().find("select.cron-time-min").val(s["mins"]).gentleSelect("update").end()}else{r[a].find("select").val(s[a]).gentleSelect("update")}}r["period"].find("select").val(n).gentleSelect("update").trigger("change");return this}};var T={periodChanged:function(){var t=e(this).data("root");var n=t.data("block"),r=t.data("options");var i=e(this).val();t.find("span.cron-block").hide();if(v.hasOwnProperty(i)){var s=v[e(this).val()];for(var o=0;o<s.length;o++){n[s[o]].show()}}},somethingChanged:function(){root=e(this).data("root");if(y(root.data("options").url_set)){if(x.value.call(root)!=root.data("current_value")){root.addClass("cron-changed");root.data("block")["controls"].fadeIn()}else{root.removeClass("cron-changed");root.data("block")["controls"].fadeOut()}}else{root.data("block")["controls"].hide()}var t=root.data("options").onChange;if(y(t)&&e.isFunction(t)){t.call(root)}},saveClicked:function(){var t=e(this);var n=t.data("root");var r=x.value.call(n);if(t.hasClass("cron-loading")){return}t.addClass("cron-loading");e.ajax({type:"POST",url:n.data("options").url_set,data:{cron:r},success:function(){n.data("current_value",r);t.removeClass("cron-loading");if(r==x.value.call(n)){n.removeClass("cron-changed");n.data("block").controls.fadeOut()}},error:function(){alert("An error occured when submitting your request. Try again?");t.removeClass("cron-loading")}})}};e.fn.cron=function(t){if(x[t]){return x[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return x.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.cron")}}})(jQuery)