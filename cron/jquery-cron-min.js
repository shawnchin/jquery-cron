(function(a){function w(a){var b=a.data("block");var c=hour=day=month=dow="*";var d=b["period"].find("select").val();switch(d){case"everyNmins":c=b["everyNmins"].find("select").val();break;case"minute":break;case"hour":c=b["mins"].find("select").val();break;case"day":c=b["time"].find("select.crontimemin").val();hour=b["time"].find("select.crontimehour").val();break;case"week":c=b["time"].find("select.crontimemin").val();hour=b["time"].find("select.crontimehour").val();dow=b["dow"].find("select").val();break;case"month":c=b["time"].find("select.crontimemin").val();hour=b["time"].find("select.crontimehour").val();day=b["dom"].find("select").val();break;case"year":c=b["time"].find("select.crontimemin").val();hour=b["time"].find("select.crontimehour").val();day=b["dom"].find("select").val();month=b["month"].find("select").val();break;default:return d}return[c,hour,day,month,dow].join(" ")}function v(a,b){if(!s(u(b.initial))){return true}if(!t(b.customValues)){return true}return false}function u(b){var c=/^((\d{1,2}|\*|\*\/\d{1,2})\s){4}(\d{1,2}|\*)$/;if(typeof b!="string"||!c.test(b)){a.error("cron: invalid initial value");return undefined}var d=b.split(" ");var e=[0,0,1,1,0];var f=[59,23,31,12,6];for(var g=0;g<d.length;g++){if(d[g]=="*")continue;else if(d[g].substring(0,2)=="*/")var h=parseInt(d[g].replace(d[g].substring(0,2),""));else var h=parseInt(d[g]);if(s(h)&&h<=f[g]&&h>=e[g])continue;if(d[g].indexOf("/"))continue;a.error("cron: invalid value found (col "+(g+1)+") in "+o.initial);return undefined}for(var i in r){if(r[i].test(b)){return i}}a.error("cron: valid but unsupported cron format. sorry.");return undefined}function t(a){return!s(a)||typeof a=="object"}function s(a){if(typeof a=="undefined"){return false}else{return true}}var b={initial:"* * * * *",everyNmins:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Every N minutes"},minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:true},url_set:undefined,customValues:undefined,onChange:undefined};var c="";for(var d=0;d<60;d++){var e=d<10?"0":"";c+="<option value='"+d+"'>"+e+d+"</option>\n"}var f="";for(var d=0;d<24;d++){var e=d<10?"0":"";f+="<option value='"+d+"'>"+e+d+"</option>\n"}var g="";for(var d=0;d<60;d++){var e=d<10?"0":"";g+="<option value='"+"*/"+d+"'>"+e+d+"</option>\n"}var h="";for(var d=1;d<32;d++){if(d==1||d==21){var i="st"}else if(d==2||d==22){var i="nd"}else if(d==3||d==23){var i="rd"}else{var i="th"}h+="<option value='"+d+"'>"+d+i+"</option>\n"}var j="";var k=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var d=0;d<k.length;d++){j+="<option value='"+(d+1)+"'>"+k[d]+"</option>\n"}var l="";var m=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];for(var d=0;d<m.length;d++){l+="<option value='"+d+"'>"+m[d]+"</option>\n"}var n="";var p=["everyNmins","minute","hour","day","week","month","year"];for(var d=0;d<p.length;d++){n+="<option value='"+p[d]+"'>"+p[d]+"</option>\n"}var q={minute:[],everyNmins:["everyNmins"],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]};var r={everyNmins:/^\*\/\d{1,2}\s(\*\s){3}\*$/,minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};var x={init:function(d){var e=d?d:{};var i=a.extend([],b,e);var k=a.extend({},b.effectOpts,e.effectOpts);a.extend(i,{everyNmins:a.extend({},b.everyNmins,k,e.everyNmins),minuteOpts:a.extend({},b.minuteOpts,k,e.minuteOpts),domOpts:a.extend({},b.domOpts,k,e.domOpts),monthOpts:a.extend({},b.monthOpts,k,e.monthOpts),dowOpts:a.extend({},b.dowOpts,k,e.dowOpts),timeHourOpts:a.extend({},b.timeHourOpts,k,e.timeHourOpts),timeMinuteOpts:a.extend({},b.timeMinuteOpts,k,e.timeMinuteOpts)});if(v(this,i)){return this}var m=[],o="",p=i.customValues;if(s(p)){for(var q in p){o+="<option value='"+p[q]+"'>"+q+"</option>\n"}}m["period"]=a("<span class='cronperiod'>"+"Every <select name='cronperiod'>"+o+n+"</select> </span>").appendTo(this).data("root",this).find("select").bind("change.cron",y.periodChanged).data("root",this).gentleSelect(k).end();m["dom"]=a("<span class='cron-block cron-block-dom'>"+" on the <select name='crondom'>"+h+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(i.domOpts).data("root",this).end();m["month"]=a("<span class='cron-block cron-block-month'>"+" of <select name='cronmonth'>"+j+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(i.monthOpts).data("root",this).end();m["mins"]=a("<span class='cron-block cron-block-mins'>"+" at <select name='cronmins'>"+c+"</select> minutes past the hour </span>").appendTo(this).data("root",this).find("select").gentleSelect(i.minuteOpts).data("root",this).end();m["everyNmins"]=a("<span class='cron-block cron-block-everyNmins'>"+"at every <select name='cronNmins'>"+g+"</select> minutes </span>").appendTo(this).data("root",this).find("select").gentleSelect(i.everyNmins).data("root",this).end();m["dow"]=a("<span class='cron-block cron-block-dow'>"+" on <select name='crondow'>"+l+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(i.dowOpts).data("root",this).end();m["time"]=a("<span class='cron-block cron-block-time'>"+" at <select name='crontimehour' class='crontimehour'>"+f+"</select>:<select name='crontimemin' class='crontimemin'>"+c+" </span>").appendTo(this).data("root",this).find("select.crontimehour").gentleSelect(i.timeHourOpts).data("root",this).end().find("select.crontimemin").gentleSelect(i.timeMinuteOpts).data("root",this).end();m["controls"]=a("<span class='cron-controls'>Â« save "+"<span class='cron-button cron-button-save'></span>"+" </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",y.saveClicked).data("root",this).end();this.find("select").bind("change.cron-callback",y.somethingChanged);this.data("options",i).data("block",m);this.data("current_value",i.initial);return x["value"].call(this,i.initial)},value:function(a){if(!a){return w(this)}var b=u(a);if(!s(b)){alert("undefined t");return false}var c=this.data("block");var d;var e;d=a.split(" ");e={mins:d[0],hour:d[1],dom:d[2],month:d[3],dow:d[4]};var f=q[b];for(var g=0;g<f.length;g++){var h=f[g];if(h=="time"){c[h].find("select.crontimehour").val(e["hour"]).gentleSelect("update").end().find("select.crontimemin").val(e["mins"]).gentleSelect("update").end()}else if(h=="everyNmins"){c[h].find("select").val(e["mins"]).gentleSelect("update").end()}else{c[h].find("select").val(e[h]).gentleSelect("update")}}c["period"].find("select").val(b).gentleSelect("update").trigger("change");return this}};var y={periodChanged:function(){var b=a(this).data("root");var c=b.data("block"),d=b.data("options");var e=a(this).val();b.find("span.cron-block").hide();if(q.hasOwnProperty(e)){var f=q[a(this).val()];for(var g=0;g<f.length;g++){c[f[g]].show()}}},somethingChanged:function(){root=a(this).data("root");if(s(root.data("options").url_set)){if(x.value.call(root)!=root.data("current_value")){root.addClass("cron-changed");root.data("block")["controls"].fadeIn()}else{root.removeClass("cron-changed");root.data("block")["controls"].fadeOut()}}else{root.data("block")["controls"].hide()}var b=root.data("options").onChange;if(s(b)&&a.isFunction(b)){b.call(root)}},saveClicked:function(){var b=a(this);var c=b.data("root");var d=x.value.call(c);if(b.hasClass("cron-loading")){return}b.addClass("cron-loading");a.ajax({type:"POST",url:c.data("options").url_set,data:{cron:d},success:function(){c.data("current_value",d);b.removeClass("cron-loading");if(d==x.value.call(c)){c.removeClass("cron-changed");c.data("block").controls.fadeOut()}},error:function(){alert("An error occured when submitting your request. Try again?");b.removeClass("cron-loading")}})}};a.fn.cron=function(b){if(x[b]){return x[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return x.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.cron")}}})(jQuery)
